<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debate: {{ topic }}</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: #fff;
    color: #666;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.7;
}

/* ── Site nav ────────────────────────────────────────── */
.site-nav {
    border-bottom: 1px solid #eee;
    padding: 14px 0;
    margin-bottom: 48px;
}

.site-nav-inner {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 60px;
}

.site-nav a {
    color: #5badf0;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.15s ease;
}

.site-nav a:hover { color: #5694f1; }

/* ── Page wrapper ────────────────────────────────────── */
.debate {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 60px 80px;
}

/* ── Debate header ───────────────────────────────────── */
.debate-header {
    margin-bottom: 36px;
    padding-bottom: 28px;
    border-bottom: 1px solid #eee;
}

.debate-header h1 {
    font-size: 28px;
    font-weight: 300;
    color: #222;
    margin-bottom: 20px;
    line-height: 1.3;
}

.participants {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.participant {
    border-left: 3px solid;
    padding: 4px 12px;
    flex: 1;
    min-width: 200px;
}

.participant-name {
    display: block;
    font-weight: 500;
    font-size: 15px;
    margin-bottom: 3px;
}

.participant-bio {
    display: block;
    font-size: 13px;
    color: #aaa;
    font-style: italic;
}

.participant-side {
    display: inline-block;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    border-radius: 3px;
    padding: 1px 6px;
    margin-top: 4px;
}

.side-for   { background: #e8f5e9; color: #2e7d32; }
.side-against { background: #fce4ec; color: #c62828; }

.model-tag {
    display: inline-block;
    font-size: 10px;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    background: #f5f5f5;
    color: #aaa;
    border-radius: 3px;
    padding: 1px 5px;
    margin-top: 4px;
}

/* ── Judge ───────────────────────────────────────────── */
.judge-card {
    margin-top: 20px;
    padding: 10px 0 0;
    border-top: 1px solid #eee;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: baseline;
}

.judge-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #bbb;
    flex-shrink: 0;
    padding-top: 2px;
}

.judge-name {
    font-weight: 500;
    font-size: 14px;
    flex-shrink: 0;
}

.judge-bio {
    font-size: 13px;
    color: #aaa;
    font-style: italic;
    flex: 1;
    min-width: 200px;
}

.judge-criteria {
    width: 100%;
    font-size: 12px;
    color: #bbb;
    margin-top: 4px;
    padding-left: 54px;
}

/* ── Transcript ──────────────────────────────────────── */
.transcript {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* ── Collapsible thoughts ────────────────────────────── */
details.thought {
    background: #fcfcfc;
    border: 1px solid #eee;
    border-radius: 3px;
    padding: 7px 14px;
}

details.thought summary {
    cursor: pointer;
    font-size: 13px;
    color: #aaa;
    font-style: italic;
    list-style: none;
    user-select: none;
}

details.thought summary::-webkit-details-marker { display: none; }
details.thought summary::before { content: "▶  "; font-size: 10px; }
details[open].thought summary::before { content: "▼  "; }

.thought-body {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #eee;
    font-size: 13px;
    color: #888;
    white-space: pre-wrap;
    line-height: 1.6;
}

/* ── Debate turns ────────────────────────────────────── */
.turn {
    border-left: 3px solid;
    padding: 14px 18px;
    background: #fcfcfc;
    border-radius: 0 3px 3px 0;
}

.turn-speaker {
    font-weight: 500;
    font-size: 12px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.turn-speech p { margin-bottom: 10px; }
.turn-speech p:last-child { margin-bottom: 0; }

/* ── Scores ──────────────────────────────────────────── */
.score {
    display: flex;
    align-items: baseline;
    gap: 6px;
    flex-wrap: wrap;
    background: #f5f5f5;
    border-radius: 3px;
    padding: 7px 14px;
    font-size: 13px;
}

.score-judge { font-weight: 500; }
.score-sep { color: #ccc; }
.score-target { font-weight: 500; }
.score-value {
    font-weight: 700;
    font-size: 14px;
    color: #222;
    background: #e8e8e8;
    border-radius: 3px;
    padding: 1px 6px;
    margin-left: 2px;
}
.score-text { color: #888; flex: 1; }

/* ── Verdict ─────────────────────────────────────────── */
.verdict {
    margin-top: 40px;
    padding: 24px 20px;
    background: #f0f7ff;
    border-left: 3px solid #5badf0;
    border-radius: 0 3px 3px 0;
}

.verdict h2 {
    font-size: 18px;
    font-weight: 400;
    color: #222;
    margin-bottom: 14px;
}

.verdict-winner {
    font-size: 22px;
    font-weight: 700;
    color: #222;
    margin-bottom: 10px;
}

.verdict-scores {
    display: flex;
    gap: 20px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.verdict-score-item {
    font-size: 14px;
    font-weight: 500;
}

.verdict-score-item .score-number {
    font-size: 20px;
    font-weight: 700;
    color: #222;
}

.verdict-body p { margin-bottom: 10px; }
.verdict-body p:last-child { margin-bottom: 0; }

.premise {
    font-size: 24px;
    color: #888;
    margin-bottom: 16px;
    margin-top: -8px;
}

.premise-result {
    display: inline-block;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    border-radius: 3px;
    padding: 3px 10px;
    margin-bottom: 24px;
}

.premise-upheld   { background: #e8f5e9; color: #2e7d32; }
.premise-rejected { background: #fce4ec; color: #c62828; }

/* ── Responsive ──────────────────────────────────────── */
@media (max-width: 540px) {
    .debate { padding: 0 20px 60px; }
    .site-nav-inner { padding: 0 20px; }
    .debate-header h1 { font-size: 22px; }
}
</style>
</head>
<body>

<nav class="site-nav">
  <div class="site-nav-inner">
    <a href="https://dantelore.com">← dantelore.com</a>
  </div>
</nav>

<div class="debate">

  <header class="debate-header">
    <h1>{{ topic }}</h1>
    {% if premise %}<p class="premise">Premise: <em>{{ premise }}</em></p>{% endif %}
    <div class="participants">
      {% for p in participants %}
      <div class="participant" style="border-color: {{ p.color }}">
        <span class="participant-name" style="color: {{ p.color }}">{{ p.name }}</span>
        {% if p.side %}
        <span class="participant-side {{ 'side-for' if p.side == 'for' else 'side-against' }}">
          {{ "For" if p.side == "for" else "Against" }}
        </span>
        {% endif %}
        {% if p.bio %}<span class="participant-bio">{{ p.bio }}</span>{% endif %}
        {% if p.model %}<span class="model-tag">{{ p.model }}</span>{% endif %}
      </div>
      {% endfor %}
    </div>
    {% if judge %}
    <div class="judge-card">
      <span class="judge-label">Judge</span>
      <span class="judge-name" style="color: {{ judge.color }}">{{ judge.name }}</span>
      {% if judge.bio %}<span class="judge-bio">{{ judge.bio }}</span>{% endif %}
      {% if judge.model %}<span class="model-tag">{{ judge.model }}</span>{% endif %}
      {% if judge.criteria %}<span class="judge-criteria">{{ judge.criteria }}</span>{% endif %}
    </div>
    {% endif %}
  </header>

  <div class="transcript">

    {% for event in events %}

    {% if event.type in ("plan", "think") %}
    <details class="thought">
      <summary>
        <span style="color: {{ event.color }}">{{ event.speaker }}</span>
        — {{ "opening plan" if event.type == "plan" else "thinks" }}
      </summary>
      <div class="thought-body">{{ event.content }}</div>
    </details>

    {% elif event.type == "turn" %}
    <div class="turn" style="border-color: {{ event.color }}">
      <div class="turn-speaker" style="color: {{ event.color }}">{{ event.speaker }}</div>
      <div class="turn-speech">{{ event.content | paragraphs }}</div>
    </div>

    {% elif event.type == "score" %}
    <div class="score">
      <span class="score-judge" style="color: {{ event.color }}">{{ event.speaker }}</span>
      <span class="score-sep">→</span>
      <span class="score-target" style="color: {{ event.target_color }}">{{ event.target }}</span>
      {% if event.score is not none %}<span class="score-value">{{ event.score }}/10</span>{% endif %}
      <span class="score-text">{{ event.content | wordwrap_collapse }}</span>
    </div>

    {% endif %}
    {% endfor %}

  </div>

  {% if verdict %}
  <div class="verdict">
    <h2>Final Verdict — <span style="color: {{ verdict.color }}">{{ verdict.judge }}</span></h2>
    {% if verdict.winner %}
    <div class="verdict-winner">
      Winner: <span style="color: {{ colors.get(verdict.winner, '#666') }}">{{ verdict.winner }}</span>
    </div>
    {% endif %}
    {% if verdict.scores %}
    <div class="verdict-scores">
      {% for name, s in verdict.scores.items() %}
      <div class="verdict-score-item">
        <span style="color: {{ colors.get(name, '#666') }}">{{ name }}</span>
        <span class="score-number"> {{ s }}/10</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% if verdict.premise is not none and verdict.premise_upheld is not none %}
    <div>
      <span class="premise-result {{ 'premise-upheld' if verdict.premise_upheld else 'premise-rejected' }}">
        Premise {{ "Upheld" if verdict.premise_upheld else "Rejected" }}
      </span>
      <span class="premise"> — <em>{{ verdict.premise }}</em></span>
    </div>
    {% endif %}
    <div class="verdict-body">{{ verdict.content | paragraphs }}</div>
  </div>
  {% endif %}

</div>
</body>
</html>
