<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Results: {{ title }}</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: #fff;
    color: #666;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.7;
}

/* ── Site nav ────────────────────────────────────────── */
.site-nav {
    border-bottom: 1px solid #eee;
    padding: 14px 0;
    margin-bottom: 48px;
}

.site-nav-inner {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 60px;
}

.site-nav a {
    color: #5badf0;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.15s ease;
}

.site-nav a:hover { color: #5694f1; }

/* ── Page wrapper ────────────────────────────────────── */
.page {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 60px 80px;
}

/* ── Header ──────────────────────────────────────────── */
.page-header {
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid #eee;
}

.page-header h1 {
    font-size: 26px;
    font-weight: 300;
    color: #222;
    margin-bottom: 6px;
}

.page-header .subtitle {
    font-size: 14px;
    color: #aaa;
}

.premise-text {
    font-size: 14px;
    color: #888;
    margin-top: 6px;
    font-style: italic;
}

/* ── Table ───────────────────────────────────────────── */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

thead th {
    text-align: left;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #aaa;
    border-bottom: 2px solid #eee;
    padding: 8px 12px 8px 0;
}

tbody tr {
    border-bottom: 1px solid #f5f5f5;
    transition: background 0.1s ease;
}

tbody tr:hover { background: #fcfcfc; }

tbody td {
    padding: 10px 12px 10px 0;
    vertical-align: middle;
    color: #555;
}

.col-run    { width: 44px; color: #aaa; font-size: 13px; }
.col-winner { font-weight: 500; color: #222; }
.col-scores { font-size: 13px; white-space: nowrap; }

/* ── Badges ──────────────────────────────────────────── */
.badge {
    display: inline-block;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    border-radius: 3px;
    padding: 2px 7px;
    white-space: nowrap;
}

.badge-upheld   { background: #e8f5e9; color: #2e7d32; }
.badge-rejected { background: #fce4ec; color: #c62828; }
.badge-unknown  { background: #f5f5f5; color: #aaa; }

/* ── Links ───────────────────────────────────────────── */
a.transcript-link {
    color: #5badf0;
    text-decoration: none;
    font-size: 13px;
    white-space: nowrap;
}

a.transcript-link:hover { color: #5694f1; text-decoration: underline; }

/* ── Stats section ───────────────────────────────────── */
.stats-section {
    margin-top: 48px;
    padding-top: 32px;
    border-top: 2px solid #eee;
}

.stats-overview {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
    margin-bottom: 40px;
}

.stat { font-size: 14px; }
.stat-value { font-size: 22px; font-weight: 700; color: #222; display: block; }
.stat-label { font-size: 12px; color: #aaa; text-transform: uppercase; letter-spacing: 0.06em; }

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-top: 0;
}

.stats-block h3 {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 12px;
}

.stats-block table {
    font-size: 13px;
}

.stats-block thead th {
    font-size: 10px;
    padding: 6px 10px 6px 0;
    border-bottom: 1px solid #eee;
}

.stats-block tbody td {
    padding: 7px 10px 7px 0;
    color: #555;
}

.stats-block tbody tr:last-child { border-bottom: none; }

.n-label { color: #bbb; font-size: 11px; }
.side-for     { color: #e65100; }
.side-against { color: #1565c0; }
.bias-pos { color: #2e7d32; }
.bias-neg { color: #c62828; }
.bias-neutral { color: #aaa; }

/* ── Responsive ──────────────────────────────────────── */
@media (max-width: 600px) {
    .page { padding: 0 20px 60px; }
    .site-nav-inner { padding: 0 20px; }
}
</style>
</head>
<body>

<nav class="site-nav">
  <div class="site-nav-inner">
    <a href="https://dantelore.com">← dantelore.com</a>
  </div>
</nav>

<div class="page">

  <header class="page-header">
    <h1>Results: {{ title }}</h1>
    <div class="subtitle">{{ rows | length }} debate{{ 's' if rows | length != 1 else '' }} recorded</div>
    {% if rows and rows[0].premise %}
    <div class="premise-text">Premise: {{ rows[0].premise }}</div>
    {% endif %}
  </header>

  <table>
    <thead>
      <tr>
        <th class="col-run">#</th>
        <th>For</th>
        <th>Against</th>
        <th>Judge</th>
        <th>Winner</th>
        <th>Scores</th>
        <th>Result</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td class="col-run">{{ row.run_num }}</td>

        <td>{{ row.agent_for or "—" }}</td>
        <td>{{ row.agent_against or "—" }}</td>
        <td>{{ row.judge or "—" }}</td>

        <td class="col-winner">{{ row.winner or "—" }}</td>

        <td class="col-scores">
          {% for name, s in row.scores.items() %}
          {{ name }}: <strong>{{ s }}</strong>{% if not loop.last %} &nbsp;·&nbsp; {% endif %}
          {% endfor %}
          {% if not row.scores %}—{% endif %}
        </td>

        <td>
          {% if row.premise_upheld is not none %}
          <span class="badge {{ 'badge-upheld' if row.premise_upheld else 'badge-rejected' }}">
            {{ "Upheld" if row.premise_upheld else "Rejected" }}
          </span>
          {% else %}
          <span class="badge badge-unknown">—</span>
          {% endif %}
        </td>

        <td>
          <a class="transcript-link" href="{{ row.transcript_filename }}">View →</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if rows %}
  <div class="stats-section">

    <!-- Overview numbers -->
    <div class="stats-overview">
      <div class="stat">
        <span class="stat-value">{{ stats.total }}</span>
        <span class="stat-label">Runs</span>
      </div>
      {% if stats.completed %}
      <div class="stat">
        <span class="stat-value" style="color: #2e7d32">{{ stats.upheld }}</span>
        <span class="stat-label">Premise Upheld</span>
      </div>
      <div class="stat">
        <span class="stat-value" style="color: #c62828">{{ stats.rejected }}</span>
        <span class="stat-label">Premise Rejected</span>
      </div>
      {% if stats.uphold_rate is not none %}
      <div class="stat">
        <span class="stat-value">{{ (stats.uphold_rate * 100) | round | int }}%</span>
        <span class="stat-label">Uphold Rate</span>
      </div>
      {% endif %}
      {% endif %}
    </div>

    <div class="stats-grid">

      <!-- Debater performance -->
      {% if stats.agents %}
      <div class="stats-block">
        <h3>Debater Performance</h3>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Side</th>
              <th>n</th>
              <th>Wins</th>
              <th>Win%</th>
              <th>Avg score</th>
            </tr>
          </thead>
          <tbody>
            {% for a in stats.agents %}
            <tr>
              <td>{{ a.name }}</td>
              <td class="{{ 'side-for' if a.side == 'for' else 'side-against' }}">{{ a.side }}</td>
              <td class="n-label">{{ a.n }}</td>
              <td>{{ a.wins }}</td>
              <td>{% if a.win_rate is not none %}{{ (a.win_rate * 100) | round | int }}%{% else %}—{% endif %}</td>
              <td>{{ a.avg_score if a.avg_score is not none else "—" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      <!-- Judge profile -->
      {% if stats.judges %}
      <div class="stats-block">
        <h3>Judge Profile</h3>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>n</th>
              <th>Upheld</th>
              <th>Rejected</th>
              <th>Uphold%</th>
              <th>Bias</th>
            </tr>
          </thead>
          <tbody>
            {% for j in stats.judges %}
            <tr>
              <td>{{ j.name }}</td>
              <td class="n-label">{{ j.n }}</td>
              <td>{{ j.upheld }}</td>
              <td>{{ j.rejected }}</td>
              <td>{% if j.uphold_rate is not none %}{{ (j.uphold_rate * 100) | round | int }}%{% else %}—{% endif %}</td>
              <td>
                {% if j.bias is not none %}
                  {% if j.bias > 0.01 %}
                    <span class="bias-pos">+{{ (j.bias * 100) | round | int }}%</span>
                  {% elif j.bias < -0.01 %}
                    <span class="bias-neg">{{ (j.bias * 100) | round | int }}%</span>
                  {% else %}
                    <span class="bias-neutral">~0%</span>
                  {% endif %}
                {% else %}—{% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      <!-- Speaking order -->
      {% if stats.order %}
      <div class="stats-block">
        <h3>Speaking Order <span class="n-label">(n={{ stats.order.n }})</span></h3>
        <table>
          <thead><tr><th>Position</th><th>Wins</th><th>Win%</th></tr></thead>
          <tbody>
            <tr>
              <td>First speaker</td>
              <td>{{ stats.order.first_wins }}</td>
              <td>{{ (stats.order.first_win_rate * 100) | round | int }}%</td>
            </tr>
            <tr>
              <td>Second speaker</td>
              <td>{{ stats.order.second_wins }}</td>
              <td>{{ (stats.order.second_win_rate * 100) | round | int }}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      {% endif %}

      <!-- Side effect -->
      {% if stats.sides.n %}
      <div class="stats-block">
        <h3>Side Effect <span class="n-label">(n={{ stats.sides.n }})</span></h3>
        <table>
          <thead><tr><th>Side</th><th>Wins</th><th>Win%</th></tr></thead>
          <tbody>
            <tr>
              <td class="side-for">For</td>
              <td>{{ stats.sides.for_wins }}</td>
              <td>{% if stats.sides.for_win_rate is not none %}{{ (stats.sides.for_win_rate * 100) | round | int }}%{% else %}—{% endif %}</td>
            </tr>
            <tr>
              <td class="side-against">Against</td>
              <td>{{ stats.sides.against_wins }}</td>
              <td>{% if stats.sides.against_win_rate is not none %}{{ (stats.sides.against_win_rate * 100) | round | int }}%{% else %}—{% endif %}</td>
            </tr>
          </tbody>
        </table>
      </div>
      {% endif %}

    </div><!-- /stats-grid -->
  </div><!-- /stats-section -->
  {% endif %}

</div>
</body>
</html>
