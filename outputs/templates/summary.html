<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Results: {{ title }}</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: #fff;
    color: #666;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.7;
}

/* ── Site nav ────────────────────────────────────────── */
.site-nav {
    border-bottom: 1px solid #eee;
    padding: 14px 0;
    margin-bottom: 48px;
}

.site-nav-inner {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 60px;
}

.site-nav a {
    color: #5badf0;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.15s ease;
}

.site-nav a:hover { color: #5694f1; }

/* ── Page wrapper ────────────────────────────────────── */
.page {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 60px 80px;
}

/* ── Header ──────────────────────────────────────────── */
.page-header {
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid #eee;
}

.page-header h1 {
    font-size: 26px;
    font-weight: 300;
    color: #222;
    margin-bottom: 6px;
}

.page-header .subtitle {
    font-size: 14px;
    color: #aaa;
}

.premise-text {
    font-size: 14px;
    color: #888;
    margin-top: 6px;
    font-style: italic;
}

/* ── Table ───────────────────────────────────────────── */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

thead th {
    text-align: left;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #aaa;
    border-bottom: 2px solid #eee;
    padding: 8px 12px 8px 0;
}

tbody tr {
    border-bottom: 1px solid #f5f5f5;
    transition: background 0.1s ease;
}

tbody tr:hover { background: #fcfcfc; }

tbody td {
    padding: 10px 12px 10px 0;
    vertical-align: middle;
    color: #555;
}

.col-run    { width: 44px; color: #aaa; font-size: 13px; }
.col-winner { font-weight: 500; color: #222; }
.col-scores { font-size: 13px; white-space: nowrap; }

/* ── Badges ──────────────────────────────────────────── */
.badge {
    display: inline-block;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    border-radius: 3px;
    padding: 2px 7px;
    white-space: nowrap;
}

.badge-upheld   { background: #e8f5e9; color: #2e7d32; }
.badge-rejected { background: #fce4ec; color: #c62828; }
.badge-unknown  { background: #f5f5f5; color: #aaa; }

/* ── Links ───────────────────────────────────────────── */
a.transcript-link {
    color: #5badf0;
    text-decoration: none;
    font-size: 13px;
    white-space: nowrap;
}

a.transcript-link:hover { color: #5694f1; text-decoration: underline; }

/* ── Stats row ───────────────────────────────────────── */
.stats {
    display: flex;
    gap: 32px;
    margin-top: 28px;
    padding-top: 20px;
    border-top: 1px solid #eee;
    flex-wrap: wrap;
}

.stat { font-size: 14px; }
.stat-value { font-size: 22px; font-weight: 700; color: #222; display: block; }
.stat-label { font-size: 12px; color: #aaa; text-transform: uppercase; letter-spacing: 0.06em; }

/* ── Responsive ──────────────────────────────────────── */
@media (max-width: 600px) {
    .page { padding: 0 20px 60px; }
    .site-nav-inner { padding: 0 20px; }
}
</style>
</head>
<body>

<nav class="site-nav">
  <div class="site-nav-inner">
    <a href="https://dantelore.com">← dantelore.com</a>
  </div>
</nav>

<div class="page">

  <header class="page-header">
    <h1>Results: {{ title }}</h1>
    <div class="subtitle">{{ rows | length }} debate{{ 's' if rows | length != 1 else '' }} recorded</div>
    {% if rows and rows[0].premise %}
    <div class="premise-text">Premise: {{ rows[0].premise }}</div>
    {% endif %}
  </header>

  <table>
    <thead>
      <tr>
        <th class="col-run">#</th>
        <th>For</th>
        <th>Against</th>
        <th>Judge</th>
        <th>Winner</th>
        <th>Scores</th>
        <th>Result</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td class="col-run">{{ row.run_num }}</td>

        <td>{{ row.agent_for or "—" }}</td>
        <td>{{ row.agent_against or "—" }}</td>
        <td>{{ row.judge or "—" }}</td>

        <td class="col-winner">{{ row.winner or "—" }}</td>

        <td class="col-scores">
          {% for name, s in row.scores.items() %}
          {{ name }}: <strong>{{ s }}</strong>{% if not loop.last %} &nbsp;·&nbsp; {% endif %}
          {% endfor %}
          {% if not row.scores %}—{% endif %}
        </td>

        <td>
          {% if row.premise_upheld is not none %}
          <span class="badge {{ 'badge-upheld' if row.premise_upheld else 'badge-rejected' }}">
            {{ "Upheld" if row.premise_upheld else "Rejected" }}
          </span>
          {% else %}
          <span class="badge badge-unknown">—</span>
          {% endif %}
        </td>

        <td>
          <a class="transcript-link" href="{{ row.transcript_filename }}">View →</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if rows %}
  {% set upheld_count = rows | selectattr("premise_upheld") | list | length %}
  {% set rejected_count = rows | rejectattr("premise_upheld") | selectattr("premise_upheld", "ne", none) | list | length %}
  {% set total = rows | length %}
  <div class="stats">
    <div class="stat">
      <span class="stat-value">{{ total }}</span>
      <span class="stat-label">Runs</span>
    </div>
    <div class="stat">
      <span class="stat-value" style="color: #2e7d32">{{ upheld_count }}</span>
      <span class="stat-label">Premise Upheld</span>
    </div>
    <div class="stat">
      <span class="stat-value" style="color: #c62828">{{ rejected_count }}</span>
      <span class="stat-label">Premise Rejected</span>
    </div>
    {% set win_counts = {} %}
    {% for row in rows if row.winner %}
      {% if row.winner in win_counts %}
        {% set _ = win_counts.update({row.winner: win_counts[row.winner] + 1}) %}
      {% else %}
        {% set _ = win_counts.update({row.winner: 1}) %}
      {% endif %}
    {% endfor %}
    {% for name, count in win_counts.items() %}
    <div class="stat">
      <span class="stat-value">{{ count }}</span>
      <span class="stat-label">{{ name }} wins</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}

</div>
</body>
</html>
